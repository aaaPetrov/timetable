<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.solvd.timetable.persistence.LessonBlockRepository">

    <select id="getLessonBlocks" resultMap="LessonBlockResultMap">
        Select
        d.name as day_name,
        ln.time_name as time_name,
        c.id as class_id,
        c.name as class_name,
        cr.id as classroom_id,
        cr.number as classroom_number,
        cr.type as classroom_type,
        t.id as teacher_id,
        t.first_name as teacher_first_name,
        t.last_name as teacher_last_name,
        s.id as subject_id,
        s.name as subject_name,
        s.room_type_needed as subject_room_type
        from
        timetable tt
        inner join
        days d on tt.day_id = d.id
        inner join
        lesson_numbers ln on tt.lesson_number_id = ln.id
        inner join
        classes c on tt.class_id = c.id
        inner join
        classrooms cr on tt.classroom_id = cr.id
        inner join
        teachers t on tt.teacher_id = t.id
        inner join
        subjects s on tt.subject_id = s.id
    </select>

    <resultMap id="LessonBlockResultMap" type="com.solvd.timetable.domain.timetable.LessonBlock" autoMapping="false">
        <result property="day" column="day_name" typeHandler="org.apache.ibatis.type.EnumTypeHandler"/>
        <result property="lessonNumber" column="time_name" typeHandler="org.apache.ibatis.type.EnumTypeHandler"/>
        <association property="grade" resultMap="com.solvd.timetable.persistence.GradeRepository.GradeResultMap"/>
        <association property="room" resultMap="com.solvd.timetable.persistence.RoomRepository.RoomResultMap"/>
        <association property="teacher" resultMap="com.solvd.timetable.persistence.TeacherRepository.TeacherResultMap"/>
        <association property="subject" resultMap="com.solvd.timetable.persistence.TeacherRepository.SubjectResultMap"/>
    </resultMap>

</mapper>
